<section id="image-optimizer-section" class="tool-section">
  <h2 class="tool-section-title"><i class="fas fa-magic"></i> Image AI Optimizer</h2>
  <p class="tool-description-section">Smartly compress, resize, convert, or crop your images with AI precision.</p>

  <div class="image-optimizer-layout">
    <div class="left-panel">
      <!-- Removed Mode Selector UI -->
      <div class="main-upload-content">
        <div class="upload-area-container">
          <label class="upload-box main-select-button" [class.drag-over]="isDragging"
            (dragover)="onDragOverSingle($event)" (dragleave)="onDragLeaveSingle($event)"
            (drop)="onDropSingle($event)">
            <input #fileInputSingle type="file" accept="image/*" (change)="onFileSelectedSingle($event)" hidden />
            <div class="upload-content" (click)="fileInputSingle.click()">
              <ng-container *ngIf="!selectedFile">
                <button type="button" class="select-pdf-file-btn">Select Image File</button>
                <div class="select-pdf-file-btn-alt-icons">
                  <button class="small-icon-btn"><i class="fas fa-cloud-upload-alt"></i></button>
                  <button class="small-icon-btn"><i class="fas fa-exchange-alt"></i></button>
                </div>
                <span class="or-drop-text">or drop image here</span>
              </ng-container>
              <ng-container *ngIf="selectedFile">
                <div class="file-preview-area">
                  <div class="file-thumbnail">
                    <i class="fas fa-file-image file-image-icon"></i>
                  </div>
                  <span class="file-name-display">{{ selectedFile.name }}</span>
                  <span class="file-size-display">({{ (selectedFile.size / 1024).toFixed(1) }} KB)</span>
                </div>
                <button type="button" class="remove-file-preview-btn"
                  (click)="$event.stopPropagation(); resetSingleFile()">
                  <i class="fas fa-times-circle"></i>
                </button>
              </ng-container>
            </div>
          </label>
        </div>
      </div>

      <!-- Dynamic form fields based on current mode -->
      <div class="dynamic-settings">
        <div *ngIf="mode === 'resize'" class="setting-group-grid">
          <div class="input-field">
            <label>Width (px)</label>
            <input type="number" [(ngModel)]="resizeWidth" class="app-input" placeholder="e.g. 1280" />
          </div>
          <div class="input-field">
            <label>Height (px)</label>
            <input type="number" [(ngModel)]="resizeHeight" class="app-input" placeholder="e.g. 720" />
          </div>
        </div>

        <div *ngIf="mode === 'convert'" class="setting-group">
          <label for="convertFormat" class="setting-label"><i class="fas fa-file-image"></i> Target Format</label>
          <select id="convertFormat" [(ngModel)]="convertFormat" class="app-select">
            <option value="">Choose Format</option>
            <option value="jpeg">JPEG (.jpg)</option>
            <option value="png">PNG (.png)</option>
            <option value="webp">WebP (.webp)</option>
          </select>
        </div>

        <div *ngIf="mode === 'crop'" class="setting-group-grid two-columns">
          <div class="input-field">
            <label>X Start (px)</label>
            <input type="number" [(ngModel)]="cropX" class="app-input" placeholder="0" />
          </div>
          <div class="input-field">
            <label>Y Start (px)</label>
            <input type="number" [(ngModel)]="cropY" class="app-input" placeholder="0" />
          </div>
          <div class="input-field">
            <label>Crop Width (px)</label>
            <input type="number" [(ngModel)]="cropWidth" class="app-input" placeholder="e.g. 300" />
          </div>
          <div class="input-field">
            <label>Crop Height (px)</label>
            <input type="number" [(ngModel)]="cropHeight" class="app-input" placeholder="e.g. 200" />
          </div>
        </div>
      </div>

      <button class="convert-action-btn"
        [disabled]="!selectedFile ||
                    (mode === 'resize' && (!resizeWidth || !resizeHeight)) ||
                    (mode === 'convert' && !convertFormat) ||
                    (mode === 'crop' && (cropX === null || cropY === null || !cropWidth || !cropHeight)) ||
                    progress > 0"
        (click)="uploadSingleFile()">
        <ng-container *ngIf="progress === 0">
          <i class="fas fa-play-circle"></i> {{ getButtonLabel() }}
        </ng-container>
        <ng-container *ngIf="progress > 0">
          <i class="fas fa-spinner fa-spin"></i> Processing... {{ progress }}%
        </ng-container>
      </button>
    </div>

    <!-- Right panel and result preview remain unchanged -->
    <div class="right-panel">
      <h3 class="panel-title"><i class="fas fa-eye"></i> Image Preview</h3>
      <div class="image-display-area" *ngIf="previewUrl">
        <img [src]="previewUrl" alt="Image Preview" class="preview-image" />
      </div>
      <div class="placeholder-text" *ngIf="!previewUrl">
        <i class="fas fa-images"></i>
        <p>Your uploaded image will appear here.</p>
      </div>

      <div class="result-area" *ngIf="downloadUrl && !errorMessage">
        <h3 class="panel-title"><i class="fas fa-check-circle"></i> Result</h3>
        <div class="result-summary">
          <p class="size-info-inline">
            <ng-container *ngIf="mode === 'compress'">
              <span class="optimized-label">{{ getResultLabel() }}: </span>
              <span class="highlight-text">{{ (compressedSize / 1024).toFixed(1) }} KB</span>
              <span class="original-size-label"> | Original: </span>
              <span class="original-size-value">{{ (originalSize / 1024).toFixed(1) }} KB</span>
            </ng-container>
            <!-- <ng-container *ngIf="mode !== 'compress'">
              <span class="final-size-label">Final Size: </span>
              <span class="highlight-text">{{ (compressedSize / 1024).toFixed(1) }} KB</span>
            </ng-container> -->
          </p>
          <div class="result-actions-inline">
            <a [href]="blobUrl" [download]="downloadedFileName" class="download-btn-compact">
              <i class="fas fa-download"></i> Download {{ getResultLabel().replace(' Size', '') }}
            </a>
            <button type="button" class="reset-conversion-btn-compact" (click)="resetSingleFile()">
              {{ getResultLabel().replace(' Size', '') }} Another
            </button>
          </div>
        </div>
      </div>

      <div class="global-status-area" *ngIf="progress > 0 && progress < 100 && !errorMessage && !downloadUrl">
        <div class="progress-info-block">
          <p class="upload-progress-text">Uploading file 1 of 1</p>
          <p class="upload-file-details">{{ selectedFile?.name }} ({{ (selectedFile?.size / 1024).toFixed(1) }} KB)</p>
          <p class="upload-speed-time-left">Time left 0 SECONDS - Upload speed 519 KB/S</p>
          <div class="progress-indicator upload-progress-bar">
            <div class="progress-bar-fill" [style.width.%]="progress"></div>
          </div>
          <p class="upload-percentage-text">{{ progress }}%</p>
          <p class="upload-status-text">UPLOADED</p>
        </div>
      </div>

      <div class="result-message-box error" *ngIf="errorMessage && !downloadUrl">
        <p>‚ùå Error: {{ errorMessage }}</p>
        <button type="button" class="reset-conversion-btn" (click)="resetSingleFile()">Try Again</button>
      </div>
    </div>
  </div>
</section>
