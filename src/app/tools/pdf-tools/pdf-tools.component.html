<div class="tool-card animate__animated animate__fadeIn">
  <div class="card-header animate__animated animate__fadeInDown">
    <h2>üìÑ PDF Conversion Tools</h2>
    <p class="sub-heading">Your one-stop solution for PDF and Image conversions</p>
  </div>

  <div class="card-content">
    <div class="mode-select animate__animated animate__fadeInUp">
      <label for="mode">Select Tool:</label>
      <div class="custom-select-wrapper">
        <select [(ngModel)]="mode" id="mode">
          <option value="jpg-to-pdf">üñºÔ∏è JPG/PNG to PDF</option>
          <option value="pdf-to-word">üìÑ PDF to Word</option>
          <option value="word-to-pdf">üìù Word to PDF</option>
          <option value="merge-images-to-pdf">üé¥ Merge Images to PDF</option> </select>
        <span class="custom-select-arrow"></span>
      </div>
    </div>

    <ng-container [ngSwitch]="mode">

      <ng-container *ngSwitchCase="'jpg-to-pdf'">
        <label class="upload-box animate__animated animate__fadeInUp"
               [class.drag-over]="isDragging"
               (dragover)="onDragOverSingle($event)"
               (dragleave)="onDragLeaveSingle($event)"
               (drop)="onDropSingle($event)">
          <input #fileInputSingle type="file"
                 [accept]="getFileAcceptTypes(mode)"
                 (change)="onFileSelectedSingle($event)" hidden />
          <div class="upload-text" (click)="fileInputSingle.click()">
            <ng-container *ngIf="!selectedFileSingle">
              <i class="fas fa-cloud-upload-alt upload-icon animate__animated animate__bounce"></i>
              <span class="upload-prompt">Click or Drag & Drop your file</span>
            </ng-container>
            <ng-container *ngIf="selectedFileSingle">
              <span class="file-selected animate__animated animate__fadeIn">
                <i class="fas fa-check-circle success-icon"></i>
                <span class="file-name">{{ selectedFileSingle.name }}</span>
              </span>
            </ng-container>
          </div>
        </label>
        <button class="convert-btn animate__animated"
                [ngClass]="{'animate__pulse': !progress, 'animate__flash': progress > 0 && progress < 100}"
                [disabled]="!selectedFileSingle || progress > 0"
                (click)="uploadSingleFile()">
          <ng-container *ngIf="progress === 0">
            <i class="fas fa-rocket launch-icon"></i> Convert
          </ng-container>
          <ng-container *ngIf="progress > 0">
            <i class="fas fa-spinner fa-spin"></i> Converting... {{ progress }}%
          </ng-container>
        </button>
      </ng-container>

      <ng-container *ngSwitchCase="'pdf-to-word'">
        <label class="upload-box animate__animated animate__fadeInUp"
               [class.drag-over]="isDragging"
               (dragover)="onDragOverSingle($event)"
               (dragleave)="onDragLeaveSingle($event)"
               (drop)="onDropSingle($event)">
          <input #fileInputSingle type="file"
                 [accept]="getFileAcceptTypes(mode)"
                 (change)="onFileSelectedSingle($event)" hidden />
          <div class="upload-text" (click)="fileInputSingle.click()">
            <ng-container *ngIf="!selectedFileSingle">
              <i class="fas fa-cloud-upload-alt upload-icon animate__animated animate__bounce"></i>
              <span class="upload-prompt">Click or Drag & Drop your file</span>
            </ng-container>
            <ng-container *ngIf="selectedFileSingle">
              <span class="file-selected animate__animated animate__fadeIn">
                <i class="fas fa-check-circle success-icon"></i>
                <span class="file-name">{{ selectedFileSingle.name }}</span>
              </span>
            </ng-container>
          </div>
        </label>
        <button class="convert-btn animate__animated"
                [ngClass]="{'animate__pulse': !progress, 'animate__flash': progress > 0 && progress < 100}"
                [disabled]="!selectedFileSingle || progress > 0"
                (click)="uploadSingleFile()">
          <ng-container *ngIf="progress === 0">
            <i class="fas fa-rocket launch-icon"></i> Convert
          </ng-container>
          <ng-container *ngIf="progress > 0">
            <i class="fas fa-spinner fa-spin"></i> Converting... {{ progress }}%
          </ng-container>
        </button>
      </ng-container>

      <ng-container *ngSwitchCase="'word-to-pdf'">
        <label class="upload-box animate__animated animate__fadeInUp"
               [class.drag-over]="isDragging"
               (dragover)="onDragOverSingle($event)"
               (dragleave)="onDragLeaveSingle($event)"
               (drop)="onDropSingle($event)">
          <input #fileInputSingle type="file"
                 [accept]="getFileAcceptTypes(mode)"
                 (change)="onFileSelectedSingle($event)" hidden />
          <div class="upload-text" (click)="fileInputSingle.click()">
            <ng-container *ngIf="!selectedFileSingle">
              <i class="fas fa-cloud-upload-alt upload-icon animate__animated animate__bounce"></i>
              <span class="upload-prompt">Click or Drag & Drop your file</span>
            </ng-container>
            <ng-container *ngIf="selectedFileSingle">
              <span class="file-selected animate__animated animate__fadeIn">
                <i class="fas fa-check-circle success-icon"></i>
                <span class="file-name">{{ selectedFileSingle.name }}</span>
              </span>
            </ng-container>
          </div>
        </label>
        <button class="convert-btn animate__animated"
                [ngClass]="{'animate__pulse': !progress, 'animate__flash': progress > 0 && progress < 100}"
                [disabled]="!selectedFileSingle || progress > 0"
                (click)="uploadSingleFile()">
          <ng-container *ngIf="progress === 0">
            <i class="fas fa-rocket launch-icon"></i> Convert
          </ng-container>
          <ng-container *ngIf="progress > 0">
            <i class="fas fa-spinner fa-spin"></i> Converting... {{ progress }}%
          </ng-container>
        </button>
      </ng-container>

      <ng-container *ngSwitchCase="'merge-images-to-pdf'">
        <label class="upload-box animate__animated animate__fadeInUp merge-images-upload-area"
               [class.has-files]="selectedFilesMultiple.length > 0"
               (dragover)="preventDefaults($event)"
               (drop)="onFilesDroppedMultiple($event)">
          <input #fileInputMultiple type="file" accept="image/*" multiple (change)="onFilesSelectedMultiple($event)" hidden />
          <div class="upload-prompt" (click)="fileInputMultiple.click()">
            <ng-container *ngIf="!selectedFilesMultiple.length">
              <i class="fas fa-cloud-upload-alt upload-icon animate__animated animate__bounce"></i>
              <p class="upload-text">Click to browse or drag & drop images here</p>
              <span class="file-types">Supports JPG, PNG, GIF, BMP</span>
            </ng-container>
            <ng-container *ngIf="selectedFilesMultiple.length">
              <div class="selected-files-summary animate__animated animate__fadeIn">
                <i class="fas fa-check-circle success-icon"></i>
                <p>{{ selectedFilesMultiple.length }} image(s) selected</p>
                <button type="button" class="clear-selection-btn animate__animated animate__shakeX"
                        (click)="$event.stopPropagation(); reset()">Clear Selection</button>
              </div>
              <div class="selected-file-list animate__animated animate__fadeInUp">
                <p>Selected Files:</p>
                <ul>
                  <li *ngFor="let file of selectedFilesMultiple" class="animate__animated animate__fadeInLeft list-item-fade">
                    <i class="fas fa-file-image file-icon"></i> {{ file.name }}
                  </li>
                </ul>
              </div>
            </ng-container>
          </div>
        </label>

        <div class="image-preview-section animate__animated animate__fadeIn" *ngIf="selectedFilesMultiple.length > 0 && previewUrlMultiple">
          <h3>First Image Preview:</h3>
          <div class="image-preview-wrapper">
            <img [src]="previewUrlMultiple" alt="Selected Image Preview" class="preview-img fade-in-img" />
          </div>
          <p class="preview-caption">
            {{ selectedFilesMultiple[0].name }}<br>
            {{ (selectedFilesMultiple[0].size / 1024).toFixed(1) }} KB
          </p>
        </div>

        <div class="usage-limit-info animate__animated animate__fadeIn" *ngIf="selectedFilesMultiple.length > 0">
          <p *ngIf="!isPremiumUserMerge && freeUsesRemainingMerge > 0">
            You can merge <span class="highlight-count">{{ freeUsesRemainingMerge }}</span> more set(s) of images today.
          </p>
          <p *ngIf="!isPremiumUserMerge && freeUsesRemainingMerge <= 0" class="limit-reached-message">
            Daily free limit reached! <a href="/pricing">Upgrade to Premium</a> for unlimited merges.
          </p>
          <p *ngIf="!isPremiumUserMerge && selectedFilesMultiple.length > freeFileLimitMerge" class="file-count-warning">
            Free users can merge up to {{ freeFileLimitMerge }} files. Consider upgrading for larger merges.
          </p>
        </div>

        <button class="convert-btn animate__animated"
                [ngClass]="{'animate__pulse': !progress, 'animate__flash': progress > 0 && progress < 100}"
                [disabled]="!selectedFilesMultiple.length || progress > 0 || (!isPremiumUserMerge && freeUsesRemainingMerge <= 0) || (!isPremiumUserMerge && selectedFilesMultiple.length > freeFileLimitMerge)"
                (click)="uploadMultipleFiles()">
          <ng-container *ngIf="progress === 0">
            <span class="btn-spinner"><i class="fas fa-rocket launch-icon"></i> Merge to PDF</span>
          </ng-container>
          <ng-container *ngIf="progress > 0">
            <span class="btn-spinner"><i class="fas fa-spinner fa-spin"></i> Merging... {{ progress }}%</span>
          </ng-container>
        </button>
      </ng-container>

      <div class="progress-container animate__animated animate__fadeIn" *ngIf="progress > 0">
        <div class="progress-bar" [style.width.%]="progress"></div>
        <p class="progress-text">{{ progress }}% Uploading...</p>
      </div>

      <div class="download-section animate__animated animate__zoomIn" *ngIf="downloadUrl">
        <p class="success-message">‚úÖ Conversion successful! Download started.</p>
        <a [href]="downloadUrl" download="merged.pdf" class="download-link animate__animated animate__heartBeat"
           *ngIf="mode === 'merge-images-to-pdf'">‚¨á Download PDF</a>
        <button type="button" class="reset-btn animate__animated animate__fadeIn" (click)="reset()">Start New Conversion</button>
      </div>

      <div class="error-section animate__animated animate__shakeX" *ngIf="errorMessage">
        <p class="error-message">‚ùå Error: {{ errorMessage }}</p>
        <button type="button" class="reset-btn animate__animated animate__fadeIn" (click)="reset()">Try Again</button>
      </div>

    </ng-container>
  </div>
</div>